# Edu3 Web3大学项目完整描述

Web3大学雏形
1.合约开发者部署平台YD代币 开发课程相关合约
2.创建课程作者创建课程制定课程价格
3.购买课程 并进行课程授权
4.创建课程作者将YD币兑换为ETH再兑换为USDT质押进AAVE进行理财
https://aave.com/docs/resources/addresses
5.用户个人中心 通过MetaMask的签名机制 实现名称修改+安全的获取已经购买的课程详情

（ETH兑换成USDT部分为选修哈 先别自己开发 有精力的同学可以自己搞）
兑换地址：https://uniswap-testnet.sourcehat.io/#/swap
USDT合约地址：0xaA8E23Fb1079EA71e0a56F48a2aA51851D8433D0


---

## 🎯 项目核心概述

Edu3是一个基于区块链技术的Web3教育平台，实现创作者课程发布、学生购买学习的去中心化价值闭环。项目采用Web2+Web3混合架构，在保证去中心化透明性的同时提供良好的用户体验。

### 业务模式核心特色

- **代币经济**: 使用YD币(ERC-20)作为平台统一支付货币
- **混合架构**: 链上存储购买关系，Web2存储课程内容
- **去中心化权益**: 智能合约保证交易透明和收益分配
- **内容保护**: 通过链上mapping验证访问权限

---

## 📈 当前项目状态

### ✅ 已完成核心功能 (70%)

#### 1. 智能合约层 
- **YDToken合约**: ERC-20标准代币实现，支持ETH兑换YD功能
- **CoursePlatform合约**: 课程创建、购买、所有权验证完整实现
- **讲师权限系统**: 申请、审核、认证完整流程
- **管理员系统**: 独立于合约owner的管理员权限控制

#### 2. 前端应用
- **技术栈**: React 19 + TypeScript + Vite + TailwindCSS 4
- **Web3集成**: Wagmi + Viem 完整钱包连接
- **用户界面**: 课程列表、创建、购买、讲师申请完整流程

#### 3. 后端API
- **Node.js + Express + PostgreSQL** 架构
- **课程管理API**: 创建、查询、元数据存储
- **讲师申请API**: 完整的申请和审核系统

#### 4. 数据索引
- **The Graph Subgraph**: 完整的链上事件索引
- **GraphQL Schema**: Course和User实体关系完整定义
- **已部署**: The Graph Studio线上运行

### 🆕 新墟功能需求分析

很简单，就是课程平台的购买逻辑。以前买课程是不是用人民币？现在用什么？用 **YD 币**。

平台里有很多课程，课程列表是存储在链上的。用户是通过 **mapping** 获取的，这些数据是透明的。

有些课程安排很紧，比如十一前一天晚上上课，然后整个假期都在上课，这就是平台的运作方式。

另外需要注意，平台代币 YD 币有很多假币，要避免买到假的 USDT 或假代币。

现在重点说开发逻辑：
课程列表展示在链上。点击课程时，需要有详情展示。详情页需要判断用户是否已经购买了课程。

判断逻辑：

- 点击详情时，需要检查链上是否存在该用户的购买记录。
- 购买关系是通过 **mapping** 结构来存储的（课程 ID → 用户地址）。
- 点击购买课程时，需要两步操作：第一步 `approve`，第二步 `purchase`。
- 课程只能使用 YD 币购买。

兑换逻辑：

- 平台要提供兑换功能，比如 ETH 兑换成 YD 币。
- 用户输入数量，确认兑换，完成交易。
- 例如：1 ETH = 4000 YD 币（示例汇率）。

课程内容存储：

- 视频、文档等课程详情不存链上，而是存在 Web2 后端。
- Web3 只负责存储课程 ID 和购买者信息。
- 这样点击详情时，通过 mapping 判断是否购买，再去 Web2 拉取内容。

mapping 结构：

- 课程 ID（如 001） → 购买者的钱包地址。
- 用户买课成功时，更新 mapping，把课程 ID 和钱包地址写进去。
- 判断逻辑：如果 mapping 里有该用户地址，就说明已购买，可以查看详情。

展示逻辑：

- 前端点击详情时，可以直接调用链上查询。
- 但如果仅用前端路由，可能导致绕过校验，谁都能看课程。
- 所以后端需要校验：如果没有课程权限，就 redirect，提示无权限。
- 前端需要把钱包地址传给后端，后端再去链上验证该地址是否有购买权限。

目前登录的钱包地址可以简单处理：前端传钱包地址给后端，后端验证即可。后续再加更复杂的防伪和鉴权机制，比如验证码、签名等。

作业要求：

- 完成 YD 币兑换功能
- 完成课程购买功能
- 完成 mapping 写入逻辑
- 钱包地址简单鉴权

### 《课程平台业务讨论》修正版（第 2 部分）

当用户购买课程后，钱（YD 币）转给谁？

不是转给合约留着，而是通过合约转给课程的创建者。平台只在中间收取手续费。

所以逻辑是：

1. 用户用 YD 币购买课程
2. YD 币通过合约转给课程作者
3. 平台收取一部分手续费

购买记录存储：

- 在链上 mapping 中，课程 ID 对应购买者的钱包地址。
- 在 Web2 中，存储课程详情（标题、视频、内容等）。
- Web3 负责透明公开的交易和购买关系，Web2 负责承载课程内容。

课程作者的收入：

- 作者收到 YD 币。
- 作者可以通过平台提供的合约功能，把 YD 币兑换成 ETH。
- 平台通过这个兑换流程收取手续费。

如果直接转账给作者，那平台赚不到钱，所以合约设计是：

- 用户先 approve YD 币给合约
- 合约代替用户把钱转给作者
- 平台中间抽成

课程创建逻辑：

- 作者创建课程时，需要设置价格（以 YD 币计价）。
- 创建课程需要调用合约，同时在 Web2 存储标题、内容等信息。
- Web2 生成 UUID 并写入数据库；UUID 写入合约映射。
- 创建课程需要花费 gas。
- 创建完成后，mapping 初始化，课程创建者自动拥有该课程权限。

数据同步：

- Web2 存储课程详情
- Web3 存储课程 ID + mapping（谁买了课程）
- 访问课程时，系统先从前端获取钱包地址，再通过后端调用链上验证。验证通过，再从 Web2 拉取详情。

安全性：

- 仅用前端传地址会有伪造风险。
- 后续可加入钱包签名验证、验证码等机制，防止假地址冒充购买者。

扩展逻辑（选修部分）：

- 作者卖课得到 YD 币后，可以将 YD 币兑换成 ETH。
- 然后可以将 ETH 存入 AAVE 协议进行质押，获得收益（约年化 5%）。
- 流程：approve → 存入 AAVE → 返回 aETH 或对应凭证 → 领取利息。
- 钱包交互过程中会多次弹窗（例如三次），分别是 approve、存入、合约返回。

课程定价：

- 创建课程时，作者只能以 YD 币定价，不能用其他币种。
- 价格例如：1 课程 = 1000 YD 币。
- 所有交易走合约，公开透明。

退款逻辑：

- 已购买的课程不能退款。
- mapping 结构一旦写入，就不可撤销。

### 《课程平台业务讨论》修正版（第 3 部分）

mapping 结构设计：

- 一种方式：`mapping (课程ID => 用户地址列表)`
- 另一种方式：`mapping (作者地址 => 课程ID => 用户地址)`
  两种方式都可以，根据业务需求选择。

访问课程详情的逻辑：

1. 用户点击课程详情
2. 前端将用户钱包地址传给后端
3. 后端到链上调用 mapping，验证该用户是否拥有访问权限
4. 如果有权限，从 Web2 拉取课程详情（标题、内容、视频）返回给用户
5. 如果没有权限，直接拒绝访问

这里要注意：

- 前端的钱包地址字符串可以伪造，所以需要后续增加防伪机制
- 简单阶段可以先通过后端校验 mapping
- 后续可以加入钱包签名认证，确保用户确实是该钱包地址的拥有者

课程创建：

- 只有 owner（合约管理员）才能创建课程，避免任何人随便调用合约乱创建
- 创建课程需要调用合约 + Web2 API
- Web2 负责存储详情，合约负责写入 mapping（课程 ID 与创建者地址的绑定）

购买课程：

- 用户点击购买 → 先 approve YD 币 → 再调用合约购买
- 合约把 YD 币转给作者，平台抽取手续费
- mapping 更新：在该课程 ID 下写入购买者钱包地址
- Web2 与 Web3 保持同步，避免数据不一致

质押与金融扩展（选修）：

- 作者获得 YD 币 → 兑换成 ETH → 存入 AAVE
- 存入 AAVE 后，会得到 aETH（收益凭证）
- 用户可以拿着 aETH 换回 ETH 或稳定币（如 USDT）
- 质押流程涉及 3 次钱包交互：approve、存入、合约返回
- AAVE 提供借贷池，用户资金通过借贷获得利息，年化约 5%

示例交互：

- 调用 `supply` 方法，把 ETH 存入 AAVE 流动性池
- 返回 aETH，代表质押凭证
- 用户可随时取出，得到本金 + 利息

数据交互总结：

- Web2 存储课程详情（标题、内容、视频等）
- Web3 存储购买关系（课程 ID ↔ 用户钱包地址）
- 前端：展示 UI，连接钱包
- 后端：负责调用链上合约，校验用户权限
- 合约：记录课程购买关系、转账逻辑

好的 👍 我继续为你整理修正版的完整文档。以下是

---

### 《课程平台业务讨论》修正版（第4部分）

业务案例：
当用户购买课程时：

1. 用户用 ETH 兑换 YD币
2. 用户 approve YD币给合约
3. 用户调用合约购买课程
4. 合约将 YD币转给课程作者，同时更新 mapping
5. 平台抽取手续费
6. 用户再次点击课程详情时，后端会去链上查询 mapping，验证是否购买成功，若是，则返回 Web2 存储的课程内容

这样设计的结果是：

* 用户无法绕过 mapping 验证直接访问课程
* 平台保证了课程购买的唯一性和安全性
* 作者能及时收到课程收入，平台也能收取合理手续费

数据一致性问题：

* Web2 存储了课程详情
* Web3 只记录购买关系
* 两边需要保持同步，例如：课程ID 在 Web2 生成后，必须写入合约 mapping

课程内容增强功能：

* 作者在创建课程时输入课程标题、简介、视频等
* 可以调用 AI 接口对标题或描述进行优化润色
* 例如点击“AI润色”，调用接口自动优化文本，这样能提升课程的专业度和可读性

课程价格：

* 只能用 YD币计价
* 例如：一门课程价格为 1000 YD币
* 用户需要先兑换 ETH → YD币，才能购买

质押系统（选修扩展）：

* 作者获得 YD币后兑换成 ETH
* 将 ETH 存入 AAVE，得到 aETH
* aETH 可以换回 ETH 或 USDT，并获得年化收益
* 整个流程包含 3 次钱包弹窗交互：

  1. approve ETH 给合约
  2. 存入 AAVE 池子
  3. 合约返回 aETH 或收益

市场逻辑：

* 平台不仅是一个课程售卖系统，同时结合了 Web3 的代币经济和金融逻辑
* 用户花费 YD币买课，作者获得 YD币
* 作者兑换 YD币 → ETH → 稳定币（USDT），甚至可以通过 AAVE 获取收益
* 平台通过手续费和代币流通形成可持续的商业模式

延伸功能（选修）：

* 课程匿名化：大学老师等讲师可以隐藏身份上课（例如戴面具，不露脸），以保护隐私
* 平台可以开放 AI 辅助模块，帮助创作者更快生成内容描述
* 结合 Story、IPFS 等协议实现内容确权和上链存证



### 《课程平台业务讨论》修正版（第5部分 / 完结）

关于课程创建和权限：

* 一个用户可以创建多个课程
* 创建者也可以去购买别人的课程
* mapping 结构可以设计为：

  * 作者地址 → 课程ID → 购买者列表
  * 或者直接 课程ID → 购买者列表
* 这种结构灵活多变，具体设计可以根据平台需求来决定

关于安全与防伪：

* 当前阶段，前端传过来的钱包地址是一个普通字符串，可以伪造
* 未来需要加入防伪机制，比如：

  * 钱包签名验证
  * Google 隐藏验证码
  * 其他 Web2 防护手段
* 最终保证用户无法伪造钱包地址去获取未购买的课程

作业和练习：

* 学生的练习任务是：

  1. 创建课程
  2. 展示课程列表
  3. ETH 兑换 YD币
  4. 用 YD币购买课程
  5. 验证 mapping 更新
  6. 实现前端钱包交互逻辑

* 选修作业是：

  * 把课程收入兑换成 ETH
  * 把 ETH 存入 AAVE 进行质押
  * 实现三次钱包交互体验
  * 获取 aETH 并计算收益

业务总结：

1. Web2 存储课程详情（标题、内容、视频、文档等）
2. Web3 存储课程 ID 与购买关系（mapping）
3. 用户购买课程流程：

   * ETH → YD币
   * approve → purchase
   * mapping 更新
   * 作者获得 YD币
   * 作者可兑换 YD币 → ETH
   * 平台收取手续费
4. 扩展：作者可进行 DeFi 操作（如存入 AAVE），获得额外收益

市场与外包讨论：

* 有的公司正在做类似的 MVP 工具，帮助创作者进行链上确权和变现
* 技术栈大同小异：前端 JS、React/Vue；后端 Node.js/Express；合约 Solidity；存储 IPFS / Story 协议

整体逻辑闭环：

* 平台通过 **课程 + YD币经济 + Web3 合约** 建立一个去中心化的课程售卖与收益体系
* 用户买课 → 作者收币 → 作者换成 ETH/USDT → 平台收取手续费
* 未来结合 AI 与 IPFS，可以增强课程内容质量和确权能力
* 业务核心是 **Web2 与 Web3 协同**：Web2 承载内容，Web3 保证交易透明和收益流通

---